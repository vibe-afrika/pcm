server:
  port: 9880

spring:
  cloud:
    gateway:
      routes:
        - id: profile-service
          uri: ${PROFILE_SERVICE_URL:http://localhost:18081}
          predicates:
            - Path=/api/v1/profiles/**
          filters:
            - name: CircuitBreaker
              args:
                name: profileService
                fallbackUri: forward:/fallback/profile
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10
                redis-rate-limiter.burstCapacity: 20
        - id: consent-service
          uri: ${CONSENT_SERVICE_URL:http://localhost:18083}
          predicates:
            - Path=/api/v1/consents/**
          filters:
            - name: CircuitBreaker
              args:
                name: consentService
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${JWT_ISSUER_URI:http://localhost:8090/auth/realms/pcm}

resilience4j:
  circuitbreaker:
    instances:
      profileService:
        slidingWindowSize: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 10s
      consentService:
        slidingWindowSize: 10
        failureRateThreshold: 50

grpc:
  client:
    profile-service:
      address: 'static://${PROFILE_GRPC_HOST:localhost}:${PROFILE_GRPC_PORT:19091}'
      negotiationType: plaintext
    segment-service:
      address: 'static://${SEGMENT_GRPC_HOST:localhost}:${SEGMENT_GRPC_PORT:19094}'
      negotiationType: plaintext
    preference-service:
      address: 'static://${PREFERENCE_GRPC_HOST:localhost}:${PREFERENCE_GRPC_PORT:19092}'
      negotiationType: plaintext
